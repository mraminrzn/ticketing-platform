
# ๐ ูุณุชูุฏุงุช ูพุงฺฏุงู ุฏุงุฏู MongoDB ุจุฑุง ุณุณุชู ฺุช

ุงู ุณูุฏ ุจู ุชุดุฑุญ ฺฉุงูู ุณุงุฎุชุงุฑ ฺฉุงูฺฉุดูโูุงุ ููุงูู ฺฉูุฏ ู ูุฏูโุณุงุฒ ุฏุงุฏูโูุง ุฏุฑ MongoDB ูโูพุฑุฏุงุฒุฏ.

## ๐ค ฺฉุงุฑุจุฑุงูุ ุฏูพุงุฑุชูุงูโูุง ู ฺฉูุชุฑู ุฏุณุชุฑุณ

ุงุณุงุณ ุณุณุชู ุจุฑ ูพุงู ุฏุงฺฉูููุชโูุง **ฺฉุงุฑุจุฑุงู** ู ูุญูู ุชุนุงูู ุขูโูุง ุจุง ุณุณุชู ุจูุง ุดุฏู ุงุณุช.

### ุฏุงฺฉูููุช ฺฉูพุงุฑฺู ฺฉุงุฑุจุฑ (Unified User Document)

ููุฌูุฏุช ุงุตู ุณุณุชูุ ฺฉุงูฺฉุดู `users` ุงุณุช. ุจู ุฌุง ฺูุฏู ุฌุฏููุ ูุฑ ฺฉุงุฑุจุฑ ฺฉ ุฏุงฺฉูููุช ุฌุงูุน ุฏุงุฑุฏ ฺฉู ุชูุงู ุงุทูุงุนุงุช ูุฑุชุจุท ุจุง ุงู ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ุฏุงุฏู ุงุณุช:

1.  **ุงุทูุงุนุงุช ูพุงู:** ููุฏูุง ูุงููุฏ `email` ู `status` ูุณุชููุงู ุฏุฑ ุฏุงฺฉูููุช ุฐุฎุฑู ูโุดููุฏ.
2.  **ูฺฺฏโูุง (Attributes):** ุจู ุฌุง ุฌุฏูู ุฌุฏุงฺฏุงููุ ฺฉ ุขุจุฌฺฉุช ุชู ุฏุฑ ุชู ุจู ูุงู `attributes` ุฏุงุฑู. ุงู ุณุงุฎุชุงุฑ ุงูุนุทุงูโูพุฐุฑ ุจู ูุง ุงุฌุงุฒู ูโุฏูุฏ ุจโููุงุช ูฺฺฏ ฺฉูุฏ-ููุฏุงุฑ (ูุงููุฏ `job_title`) ุจู ฺฉุงุฑุจุฑ ุงุถุงูู ฺฉูู.
3.  **ุฏูพุงุฑุชูุงูโูุง (Departments):** ฺฉุงุฑุจุฑุงู ุงุฒ ุทุฑู ฺฉ ุขุฑุงู ุงุฒ ุดูุงุณูโูุง ุจู ูุงู `department_ids` ุจู ฺฉุงูฺฉุดู `departments` ุงุฑุฌุงุน ุฏุงุฏู ูโุดููุฏ.
4.  **ุฌูุณุงุช (Sessions):** ุชูฺฉูโูุง ุงุญุฑุงุฒ ููุช ูุฑ ฺฉุงุฑุจุฑ ุฏุฑ ฺฉ ุขุฑุงู ุชู ุฏุฑ ุชู ุจู ูุงู `sessions` ุฏุฑูู ุฏุงฺฉูููุช ุฎูุฏ ฺฉุงุฑุจุฑ ุฐุฎุฑู ูโุดูุฏ.

### ุงุญุฑุงุฒ ููุช ู ฺฉูุชุฑู ุฏุณุชุฑุณ ูุจุชู ุจุฑ ูฺฺฏ (ABAC)

ุงู ูุฏู ุฏุงุฏู ุจุฑุง ูพุงุฏูโุณุงุฒ **ฺฉูุชุฑู ุฏุณุชุฑุณ ูุจุชู ุจุฑ ูฺฺฏ (ABAC)** ุงุฏูโุขู ุงุณุช. ูุฌูุฒูุง ุจุฑ ุงุณุงุณ ููุฏูุง ููุฌูุฏ ุฏุฑ ุขุจุฌฺฉุช `attributes` ูุฑ ฺฉุงุฑุจุฑ ุชุนู ูโุดูุฏ. ุจุฑุง ูุซุงูุ ุงฺฏุฑ ฺฉุงุฑุจุฑ ููุฏ `attributes.canCloseTicket` ุจุง ููุฏุงุฑ `true` ุฑุง ุฏุงุดุชู ุจุงุดุฏุ ุณุณุชู ุจู ุงู ุงุฌุงุฒู ุจุณุชู ุชฺฉุช ุฑุง ูโุฏูุฏ.

## ๐ฌ ุณุณุชู ุงุฑุชุจุงุท: ฺฉุงูฺฉุดู Chats

### ุฏุงฺฉูููุช ฺุช (Chat Document)

ฺฉุงูฺฉุดู `chats` ููุจ ุณุณุชู ุงุฑุชุจุงุท ุงุณุช. ูุฑ ุฏุงฺฉูููุช ุฏุฑ ุงู ฺฉุงูฺฉุดูุ ฺฉ ูฺฉุงููู ฺฉุงูู ุฑุง ุฏุฑ ุฎูุฏ ูฺฏู ูโุฏุงุฑุฏ. ฺฉ ููุฏ ฺฉูุฏ ุจู ูุงู `type`ุ ูุงูุช ูฺฉุงููู ุฑุง ูุดุฎุต ูโฺฉูุฏ:

*   `type = 'CHAT'`: ฺฉ ฺฏูุชฺฏู ุฒูุฏู ู ุขู.
*   `type = 'TICKET'`: ฺฉ ุฏุฑุฎูุงุณุช ูพุดุชุจุงู ุฑุณู ุจุง ูุงุจูุช ูพฺฏุฑ.

### ูพุงูโูุง ุชู ุฏุฑ ุชู (Embedded Messages)

ุจู ุฌุง ฺฉ ุฌุฏูู ุฌุฏุงฺฏุงููุ ุชูุงู ูพุงูโูุง ฺฉ ูฺฉุงููู ุฏุฑ ฺฉ ุขุฑุงู ุจู ูุงู `messages` ุฏุฑูู ููุงู ุฏุงฺฉูููุช ฺุช ุฐุฎุฑู ูโุดููุฏ. ุงู ูุฏูโุณุงุฒ ูุฒุช ุงุตู MongoDB ุจุฑุง ุงู ุณุณุชู ุงุณุชุ ุฒุฑุง ุจุฑุง ุจุงุฒุงุจ ฺฉู ุชุงุฑุฎฺู ฺฉ ฺุชุ ุชููุง ฺฉ ฺฉูุฆุฑ ูุงุฒู ุงุณุช.

## ๐๏ธ ูุฑุฌุน ฺฉุงูู ฺฉุงูฺฉุดูโูุง

### ๐ค ฺฉุงูฺฉุดู ฺฉุงุฑุจุฑุงู (users)

ุงู ฺฉุงูฺฉุดู ุดุงูู ุชูุงู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑุงูุ ูฺฺฏโูุง ู ูุดุณุชโูุง ุขูโูุงุณุช.

```

{
  "_id": ObjectId("..."),
  "email": "user@example.com",
  "hashPassword": "...",
  "status": "ACTIVE", // ACTIVE, INACTIVE, BANNED
  "isOnline": true,
  "createdAt": ISODate("..."),
  "department_ids": [ 
    ObjectId("..."), // Ref to departments collection
    ObjectId("...") 
  ],
  "attributes": {
    "fullName": "ูุงู ฺฉุงุฑุจุฑ",
    "permission_level": "admin"
  },
  "sessions": [
    {
      "token": "...",
      "createdAt": ISODate("..."),
      "expiresAt": ISODate("...")
    }
  ]
}
        
```

### ๐ข ฺฉุงูฺฉุดู ุฏูพุงุฑุชูุงูโูุง (departments)

ฺฉุงูฺฉุดู ุณุงุฏู ุจุฑุง ุชุนุฑู ุชูโูุง ู ฺฏุฑููโูุง ฺฉุงุฑ ฺฉู ฺฉุงุฑุจุฑุงู ุจู ุขู ุงุฑุฌุงุน ุฏุงุฏู ูโุดููุฏ.

```

{
  "_id": ObjectId("..."),
  "name": "ูพุดุชุจุงู ูู",
  "description": "ุชู ูุณุฆูู ูพุงุณุฎฺฏู ุจู ูุดฺฉูุงุช ูู ฺฉุงุฑุจุฑุงู"
}
        
```

### ๐ฌ ฺฉุงูฺฉุดู ฺุชโูุง (chats)

ูุฑ ุฏุงฺฉูููุช ุฏุฑ ุงู ฺฉุงูฺฉุดู ฺฉ ูฺฉุงููู ฺฉุงูู ุจุง ุชูุงู ูพุงูโูุงุด ุงุณุช.

```

{
  "_id": ObjectId("..."),
  "title": "ูุดฺฉู ุฏุฑ ูุฑูุฏ ุจู ุณุณุชู",
  "status": "OPEN", // OPEN, CLOSED, PENDING
  "type": "TICKET", // TICKET, CHAT
  "participants": [
    { "user_id": ObjectId("..."), "role": "customer" },
    { "user_id": ObjectId("..."), "role": "operator" }
  ],
  "createdAt": ISODate("..."),
  "updatedAt": ISODate("..."),
  "endedAt": null,
  "messages": [
    {
      "_id": ObjectId("..."),
      "content": "ุณูุงูุ ูู ูุดฺฉู ุฏุงุฑู.",
      "sender_id": ObjectId("..."),
      "createdAt": ISODate("..."),
      "isSystemMessage": false,
      "replyTo_id": null
    }
  ]
}
        
```

## ๐พ ฺฉุด ฺฉุฑุฏู ุฏุฑ Redis

ุจุฑุง ุงูุฒุงุด ุนููฺฉุฑุฏุ ุฏุงุฏูโูุง ฺฉู ุฒุงุฏ ุฎูุงูุฏู ูโุดููุฏ ุจุงุฏ ุฏุฑ Redis ฺฉุด ุดููุฏ ุชุง ูุดุงุฑ ุงุฒ ุฑู **MongoDB** ุจุฑุฏุงุดุชู ุดูุฏ. ูููโุชุฑู ููุงุฑุฏ ุนุจุงุฑุชูุฏ ุงุฒ:

*   **ูุถุนุช ุขููุงู ุจูุฏู ฺฉุงุฑุจุฑ (User Presence):** ุจุฑุง ููุงุด ูุญุธูโุง ูุถุนุช ฺฉุงุฑุจุฑุงู.
*   **ุงุทูุงุนุงุช ุงูพุฑุงุชูุฑูุง ุฏุฑ ุฏุณุชุฑุณ:** ุจุฑุง ูุณุฑุงุจ ุณุฑุน ฺุชโูุง ุฌุฏุฏ.
*   **ุตูโูุง ูพุฑุฏุงุฒุด ูพุณโุฒููู (Background Job Queues):** ุจุฑุง ูุฏุฑุช ฺฉุงุฑูุง ุบุฑููุฒูุงู.

## ๐ ูุฏูโุณุงุฒ ุฑูุงุจุท ุฏุฑ MongoDB

ุฏุฑ MongoDBุ ุฑูุงุจุท ุจู ุฏู ุฑูุด ุงุตู ูุฏูโุณุงุฒ ูโุดููุฏ:

*   **ุงุฏุบุงู (Embedding):** ุจุฑุง ุฑูุงุจุท "ฺฉ ุจู ฺูุฏ" ฺฉู ุฏุงุฏูโูุง ุจู ูู ูุงุจุณุชฺฏ ุดุฏุฏ ุฏุงุฑูุฏ.  
    **ูุซุงู:** ุขุฑุงู `messages` ุฏุฑูู ูุฑ ุฏุงฺฉูููุช `chats` ู ุขุจุฌฺฉุช `attributes` ุฏุฑูู ูุฑ ุฏุงฺฉูููุช `users`.
*   **ุงุฑุฌุงุน (Referencing):** ุจุฑุง ุฑูุงุจุท "ฺูุฏ ุจู ฺูุฏ" ุง ุฒูุงู ฺฉู ุญุฌู ุฏุงุฏูโูุง ูุฑุชุจุท ุฒุงุฏ ุงุณุช.  
    **ูุซุงู:** ุขุฑุงู `department_ids` ุฏุฑ ุฏุงฺฉูููุช `users` ฺฉู ุจู ุดูุงุณูโูุง ฺฉุงูฺฉุดู `departments` ุงุฑุฌุงุน ูโุฏูุฏ.

ุงู ูุณุชูุฏ ุฏุฑ ุชุงุฑุฎ ฑ ุณูพุชุงูุจุฑ ฒฐฒต ุจูโุฑูุฒุฑุณุงู ุดุฏู ุงุณุช.